<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Click Store - Página del Comerciante</title>
  <!-- CSS Parte Inicio -->
  <link rel="stylesheet" type="text/css" href="js/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.carousel.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.transitions.css" />
  <link rel="stylesheet" type="text/css" href="css/responsive.css" />
  <link rel="stylesheet" type="text/css" href="css/estilop.css" /> 
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans' type='text/css'>
  <!-- CSS Parte Fin -->
  <!-- Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <!-- Axios library -->
   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 
   <!-- jQuery script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Owl Carousel script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f5f5f5;
      color: #333;
    }

    .container-main {
      display: flex;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .comerciante-recuadro {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      margin-right: 20px;
      width: 300px;
    }

    .comerciante-recuadro h2 {
      font-size: 22px;
      color: #ff9900;
    }

    .comerciante-recuadro p {
      font-size: 16px;
      color: #555;
      margin-bottom: 10px;
    }

    .dashboard-item {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #f8f9fa;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .dashboard-item h4 {
      font-size: 18px;
      color: #ff9500;
      margin-bottom: 5px;
    }

    .dashboard-item p {
      font-size: 16px;
      color: #333;
    }

    .product-list {
      flex: 1;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .product-list h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #ff9500;
    }

    .product-item {
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 15px;
      text-align: center;
      width: 250px;
      height: 420px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      background-color: #fff;
      display: inline-block;
      vertical-align: top;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    .product-item h3 {
      font-size: 18px;
      height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-item p {
      font-size: 14px;
      color: #555;
      height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-item .price {
      font-size: 18px;
      color: #28a745;
      margin-top: 10px;
      font-weight: bold;
    }

    .product-item .ver-mas {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #ff9d00;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .product-item .ver-mas:hover {
      background-color: #b37a00;
    }

    #subir-producto-btn {
      background-color: #28a745;
      color: white;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
      border-radius: 5px;
      padding: 10px 20px;
    }

    #subir-producto-btn:hover {
      background-color: #218838;
    }

    .nav-links {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-links .comerciante-info {
      font-size: 16px;
      color: #555;
      font-weight: bold;
    }

    footer {
      background-color: #ff9100;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      bottom: 0;
      width: 100%;
    }

    footer a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .container {
      margin-top: 30px;
    }

    h2 {
      color: #ff7700;
    }

    .chart-container {
      width: 100%;
      height: 400px;
      margin-top: 20px;
    }

    .dashboard-charts {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .chart-box {
      width: 48%;
    }

    canvas {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
    }

#productos-recomendados {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin-top: 20px;
}

.producto {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 15px;
  background-color: #fff;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;
  width: 200px;
  text-align: center;
}

.producto:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.producto img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}

.producto p {
  margin: 5px 0;
  font-size: 14px;
  color: #333;
}
.producto .precio {
  font-size: 16px;
  font-weight: bold;
  color: #28a745;
}

.producto .calificacion {
  font-size: 14px;
  color: #666;
}
 
.ver-mas {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #ff9d00; 
  color: white; 
  border: none;
  padding: 8px 15px;
  cursor: pointer;
  text-decoration: none;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

.ver-mas:hover {
  background-color: #b37a00;
}


  </style>
</head>

<body class="amazon-style">
  <div class="wrapper-wide">
    <!-- Inicio del encabezado --> 
    <header class="header">
      <div class="logo">
        <a href="index.html"><img class="img-responsive" src="image/logo.png" title="Click Store" alt="Click Store" /></a>
      </div>
      <!--
      <div class="search-bar">
        <select>
          <option value="Todos">Todos</option>
          <option value="Electrónica">Electrónica</option>
          <option value="Informática">Informática</option>
          <option value="Ropa">Ropa</option>
          <option value="Automóviles">Automóviles</option>
          <option value="Belleza">Belleza</option>
        </select>
        <input id="filter_name" type="text" name="search" value="" placeholder="Buscar Producto" />
        <button type="button" class="button-search"><i class="fa fa-search"></i></button>
      </div>-->
      <div class="nav-links">
        <span id="nombre-comerciante" class="comerciante-info"></span>
        <a href="#" id="logout-btn">Cerrar Sesión</a>
      </div>
    </header>
    <!-- Encabezado End -->

    <!-- Botón de Subir Artículo -->
    <div class="container text-right">
      <button id="subir-producto-btn" class="btn btn-success" onclick="redirigirAProductos()">Subir Artículo</button>
    </div>

    <!-- Contenedor principal con comerciante y productos -->
    <div class="container-main">
      <!-- Información del Comerciante -->
      <div class="comerciante-recuadro">
        <h2>Información del Comerciante</h2>
        <div id="comerciante-info"></div>

        <!-- Dashboard del Comerciante -->
        <div class="dashboard-item">
          <h4>Total de Productos</h4>
          <p id="total-productos"></p>
        </div>
        <div class="dashboard-item">
          <h4>Producto más Caro</h4>
          <p id="producto-mas-caro"></p>
        </div>
      </div>

      <!-- Contenedor de la lista de productos -->
      <div class="product-list">
        <h1>Mis Productos</h1>
        <div id="productos-lista"> </div>

          <!--Recomendaciones -->
          <div class="product-list">
            <h1>Tal vez te pueda interesar subir estos artículos similares</h1>
            <div class="container-main" id="productos-recomendados"></div>
        </div>
 </div>

    <!-- Gráficos de ventas -->
    <div class="dashboard-charts container">
      <div class="chart-box">
        <h2>Artículos Más Vendidos</h2>
        <canvas id="topProductsChart"></canvas>
      </div>
      <div class="chart-box">
        <h2>Ventas Mensuales</h2>
        <canvas id="monthlySalesChart"></canvas>
      </div>
    </div>

  
    <!-- Modal para editar producto -->
    <div class="modal fade" id="editarProductoModal" tabindex="-1" role="dialog" aria-labelledby="editarProductoModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="editarProductoModalLabel">Editar Producto</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="producto-id">
            <div class="form-group">
              <label for="producto-nombre">Nombre del Producto</label>
              <input type="text" class="form-control" id="producto-nombre">
            </div>
            <div class="form-group">
              <label for="producto-descripcion">Descripción</label>
              <textarea class="form-control" id="producto-descripcion"></textarea>
            </div>
            <div class="form-group">
              <label for="producto-precio">Precio</label>
              <input type="number" class="form-control" id="producto-precio">
            </div>
            <div class="form-group">
              <label for="producto-foto">URL de la Foto</label>
              <input type="text" class="form-control" id="producto-foto">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" onclick="eliminarProducto()">Eliminar</button>
            <button type="button" class="btn btn-primary" onclick="guardarCambiosProducto()">Guardar Cambios</button>
          </div>
        </div>
      </div>
    </div>
<!-- Modal para Agregar Producto en Recomendaciones-->
<div class="modal fade" id="agregarProductoModal" tabindex="-1" role="dialog" aria-labelledby="agregarProductoModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="agregarProductoModalLabel">Agregar Producto</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="nuevo-producto-id">
        <div class="form-group">
          <label for="nuevo-producto-nombre">Nombre del Producto</label>
          <input type="text" class="form-control" id="nuevo-producto-nombre">
        </div>
        <div class="form-group">
          <label for="nuevo-producto-descripcion">Descripción</label>
          <textarea class="form-control" id="nuevo-producto-descripcion"></textarea>
        </div>
        <div class="form-group">
          <label for="nuevo-producto-precio">Precio</label>
          <input type="number" class="form-control" id="nuevo-producto-precio">
        </div>
        <div class="form-group">
          <label for="nuevo-producto-foto">URL de la Foto</label>
          <input type="text" class="form-control" id="nuevo-producto-foto">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="agregarProducto()">Confirmar</button>
      </div>
    </div>
  </div>
</div>


    <!-- Pie de Página Inicio -->
    <footer id="footer">
      <p>&copy; 2024 Click Store | <a href="index.html">Inicio</a> | <a href="contact.html">Contacto</a></p>
    </footer>

    <!-- Parte JS Inicio -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="js/api.js"></script>
    <!-- Parte JS Fin -->

    <!-- Simulación de gráficos con Chart.js -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const nombreComerciante = sessionStorage.getItem('nombre');
        if (nombreComerciante) {
          document.getElementById('nombre-comerciante').textContent = `Bienvenido, ${nombreComerciante}`;
        } else {
          window.location.href = 'login.html';
        }
  
        fetchProductos(); // Cargar los productos del comerciante
        fetchComercianteInfo(); // Cargar la información del comerciante
  
        document.getElementById('logout-btn').addEventListener('click', function() {
          sessionStorage.removeItem('nombre');
          sessionStorage.removeItem('Id');
          sessionStorage.removeItem('tipo');
          window.location.href = 'login.html';
        });
      });

      // Función para simular gráficos con datos reales de los productos
      function simularGraficos(productos) {
        // Extraer nombres y simular datos de ventas de los productos
        const nombresProductos = productos.map(p => p.nombre);
        const ventasSimuladas = productos.map(() => Math.floor(Math.random() * 30) + 5); // Simular ventas entre 5 y 35

        // Gráfico de Artículos Más Vendidos
        const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
        const topProductsChart = new Chart(topProductsCtx, {
          type: 'bar',
          data: {
            labels: nombresProductos,
            datasets: [{
              label: 'Ventas',
              data: ventasSimuladas,
              backgroundColor: '#ff9900'
            }]
          }
        });

        // Gráfico de Ventas Mensuales
        const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
        const ventasMensuales = Array.from({ length: 6 }, () => Math.floor(Math.random() * 50000) + 50000); // Simular ventas mensuales
        const monthlySalesChart = new Chart(monthlySalesCtx, {
          type: 'line',
          data: {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
            datasets: [{
              label: 'Ventas en ₲',
              data: ventasMensuales,
              backgroundColor: 'rgba(255, 153, 0, 0.2)',
              borderColor: '#ff9900',
              borderWidth: 2
            }]
          }
        });
      }

      // Función para obtener los productos del comerciante
      function fetchProductos() {
        const comercianteId = sessionStorage.getItem('Id');
        fetch(`http://localhost:3000/api/productos?comercianteId=${comercianteId}`)
          .then(response => response.json())
          .then(data => {
            displayProductos(data);
            actualizarDashboard(data);
            simularGraficos(data); // Simular gráficos con los productos obtenidos
          })
          .catch(err => console.error('Error fetching productos:', err));
      }

      // Función para obtener la información del comerciante
      function fetchComercianteInfo() {
        const comercianteId = sessionStorage.getItem('Id');
        fetch(`http://localhost:3000/api/comerciantes/${comercianteId}`)
          .then(response => response.json())
          .then(data => displayComercianteInfo(data))
          .catch(err => console.error('Error fetching comerciante info:', err));
      }

      // Mostrar información del comerciante
      function displayComercianteInfo(comerciante) {
        const comercianteInfo = document.getElementById('comerciante-info');
        comercianteInfo.innerHTML = `
          <h3>${comerciante.nombre}</h3>
          <p><strong>Email:</strong> ${comerciante.email}</p>
          <p><strong>Dirección:</strong> ${comerciante.direccion}</p>
          <p><strong>Teléfono:</strong> ${comerciante.telefono}</p>
          <p><strong>Descripción:</strong> ${comerciante.descripcion}</p>
          <p><strong>Enlace a la tienda:</strong> <a href="${comerciante.enlace_tienda}" target="_blank">${comerciante.enlace_tienda}</a></p>
        `;
      }
  
      // Mostrar productos en la página
      function displayProductos(productos) {
        const container = document.getElementById('productos-lista');
        container.innerHTML = '';
        productos.forEach(producto => {
          const item = document.createElement('div');
          item.className = 'product-item';
          item.innerHTML = `
            <img src="${producto.foto_url}" alt="${producto.nombre}" class="product-image">
            <h3>${producto.nombre}</h3>
            <p>${producto.descripcion.substring(0, 60)}...</p>
            <p class="price">₲${Number(producto.precio).toLocaleString('es-PY')}</p>
            <button class="ver-mas" onclick="editarProducto(${producto.id})">Editar Producto</button>
          `;
          container.appendChild(item);
        });
      }

      // Actualizar el dashboard del comerciante
      function actualizarDashboard(productos) {
        const totalProductos = productos.length;
        const productoMasCaro = productos.reduce((max, producto) => producto.precio > max.precio ? producto : max, productos[0]);

        document.getElementById('total-productos').textContent = totalProductos;
        document.getElementById('producto-mas-caro').textContent = `${productoMasCaro.nombre} - ₲${Number(productoMasCaro.precio).toLocaleString('es-PY')}`;
      }
  
      // Función para editar producto
      function editarProducto(id) {
        fetch(`http://localhost:3000/api/productos/${id}`)
          .then(response => response.json())
          .then(data => {
            document.getElementById('producto-id').value = data.id;
            document.getElementById('producto-nombre').value = data.nombre;
            document.getElementById('producto-descripcion').value = data.descripcion;
            document.getElementById('producto-precio').value = data.precio;
            document.getElementById('producto-foto').value = data.foto_url;
            $('#editarProductoModal').modal('show');
          })
          .catch(err => console.error('Error al cargar producto para editar:', err));
      }

      // Función para eliminar producto
      function eliminarProducto() {
        const productoId = document.getElementById('producto-id').value;
  
        fetch(`http://localhost:3000/api/productos/${productoId}`, {
          method: 'DELETE'
        })
        .then(response => {
          if (response.ok) {
            $('#editarProductoModal').modal('hide');
            fetchProductos(); // Recargar los productos después de la eliminación
          } else {
            alert('Error al eliminar el producto');
          }
        })
        .catch(err => console.error('Error eliminando producto:', err));
      }
  
      function redirigirAProductos() {
        window.location.href = 'productos.html';
      }

  
      // URL de tu API de recomendaciones
      document.addEventListener('DOMContentLoaded', function() {
              // Realiza la solicitud para obtener recomendaciones
              axios.get('http://127.0.0.1:5000/recomendaciones')
                  .then(response => {
                      const recomendaciones = response.data;
                      mostrarRecomendaciones(recomendaciones);
                  })
                  .catch(error => {
                      console.error('Error al cargar recomendaciones:', error);
                  });

        // Función para mostrar las recomendaciones en el contenedor
    function mostrarRecomendaciones(recomendaciones) {
        const contenedor = document.getElementById('productos-recomendados');
        contenedor.innerHTML = ''; // Limpia el contenedor

        recomendaciones.forEach(recomendacion => {
            const productoDiv = document.createElement('div');
            productoDiv.classList.add('product-item'); // Asegura que tenga la clase correcta

            // Crea la estructura HTML para cada producto recomendado
            productoDiv.innerHTML = `
                <img src="${recomendacion.foto_url}" alt="${recomendacion.nombre}" class="product-image">
                <h3>${recomendacion.nombre}</h3>
                <p>${recomendacion.descripcion}</p>
                <p class="price">Precio: ₲${Number(recomendacion.precio).toLocaleString('es-PY')}</p>
                <button class="ver-mas" onclick='mostrarAgregarProductoModal(${JSON.stringify(recomendacion)})'>Agregar Producto</button>
            `;

            // Añade cada producto al contenedor
            contenedor.appendChild(productoDiv);
        });
    }

            // Función para manejar el clic en "Agregar Producto"
            function agregarProducto(productoId) {
                // Lógica para agregar el producto
                alert(`Producto con ID ${productoId} agregado.`);
            }

        });
            
            // Función para mostrar el modal de agregar producto con los datos del producto seleccionado
        function mostrarAgregarProductoModal(producto) {
          // Asignar los valores del producto a los campos del modal
          document.getElementById('nuevo-producto-id').value = producto.id; // Asumiendo que 'producto.id' es el identificador
          document.getElementById('nuevo-producto-nombre').value = producto.nombre;
          document.getElementById('nuevo-producto-descripcion').value = producto.descripcion;
          document.getElementById('nuevo-producto-precio').value = producto.precio;
          document.getElementById('nuevo-producto-foto').value = producto.foto_url;

          // Mostrar el modal
          $('#agregarProductoModal').modal('show');
        }

        // Función para agregar (o modificar) un producto
        function agregarProducto() {
        const nombre = document.getElementById('nuevo-producto-nombre').value;
        const descripcion = document.getElementById('nuevo-producto-descripcion').value;
        const precio = document.getElementById('nuevo-producto-precio').value;
        const fotoUrl = document.getElementById('nuevo-producto-foto').value;

        axios.post('http://127.0.0.1:5000/api/productos', {
            nombre: nombre,
            descripcion: descripcion,
            precio: precio,
            foto_url: fotoUrl
        })
        .then(response => {
            alert('Producto registrado exitosamente');
            // Aquí puedes actualizar la lista de productos o cerrar el modal
        })
        .catch(error => {
            console.error('Error al registrar el producto:', error);
            alert('Hubo un error al registrar el producto');
        });
    }


    </script>
    
  </div>
</body>
</html>
