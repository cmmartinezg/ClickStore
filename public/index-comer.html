<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Click Store - Panel del Comerciante</title>
  <!-- CSS Parte Inicio -->
  <link rel="stylesheet" type="text/css" href="js/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.carousel.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.transitions.css" />
  <link rel="stylesheet" type="text/css" href="css/responsive.css" />
  <link rel="stylesheet" type="text/css" href="css/estilop.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans' type='text/css'>
  <!-- CSS Parte Fin -->
  <!-- Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Axios library -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- jQuery script -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Owl Carousel CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />
  <!-- Owl Carousel JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

  <style>
    /* Variables de colores para fácil modificación */
    :root {
      --primary-color: #ff6f61;
      --secondary-color: #ff9e80;
      --text-color: #333;
      --background-color: #f9f9f9;
      --font-family: 'Open Sans', sans-serif;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #fff;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e5e5;
    }

    .logo img {
      max-width: 180px;
    }

    .nav-links {
      display: flex;
      align-items: center;
    }

    .nav-links .comerciante-info {
      font-size: 16px;
      color: var(--text-color);
      font-weight: bold;
      margin-right: 20px;
    }

    .nav-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: bold;
    }

    .nav-links a:hover {
      text-decoration: underline;
    }

    .container-main {
      display: flex;
      flex-wrap: wrap;
      margin: 20px;
    }

    .comerciante-recuadro {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      margin-right: 20px;
      width: 300px;
    }

    .comerciante-recuadro h2 {
      font-size: 24px;
      color: var(--primary-color);
      margin-bottom: 20px;
    }

    .comerciante-recuadro p {
      font-size: 16px;
      color: #555;
      margin-bottom: 10px;
    }

    .dashboard-item {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #fff7f5;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .dashboard-item h4 {
      font-size: 18px;
      color: var(--primary-color);
      margin-bottom: 5px;
    }

    .dashboard-item p {
      font-size: 16px;
      color: var(--text-color);
    }

    .product-list {
      flex: 1;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-top: 20px;
    }

    .product-list h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .product-item {
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 15px;
      text-align: center;
      width: 250px;
      height: 420px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      display: inline-block;
      vertical-align: top;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-right: 15px;
    }

    .product-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    .product-item h3 {
      font-size: 18px;
      height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--text-color);
    }

    .product-item p {
      font-size: 14px;
      color: #555;
      height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-item .price {
      font-size: 18px;
      color: #28a745;
      margin-top: 10px;
      font-weight: bold;
    }

    .product-item .ver-mas {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .product-item .ver-mas:hover {
      background-color: #e65b54;
    }

    #subir-producto-btn {
      background-color: var(--primary-color);
      color: #fff;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
      border-radius: 5px;
      padding: 10px 20px;
      border: none;
    }

    #subir-producto-btn:hover {
      background-color: #e65b54;
    }

    footer {
      background-color: #333;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      bottom: 0;
      width: 100%;
      margin-top: 40px;
    }

    footer a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .dashboard-charts {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .chart-box {
      width: 48%;
      margin-bottom: 30px;
    }

    .chart-box h2 {
      font-size: 24px;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    canvas {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
    }

    #productos-recomendados {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
      max-width: 100%;
    }

    .producto {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      width: 200px;
      text-align: center;
      margin-right: 10px;
    }

    .producto:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .producto img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .producto p {
      margin: 5px 0;
      font-size: 14px;
      color: #333;
    }

    .producto .precio {
      font-size: 16px;
      font-weight: bold;
      color: #28a745;
    }

    .producto .calificacion {
      font-size: 14px;
      color: #666;
    }

    .ver-mas {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .ver-mas:hover {
      background-color: #e65b54;
    }

    .filter-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      width: 100%;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .filter-container input.form-control {
      width: 100%;
      max-width: 400px;
      margin-bottom: 10px;
    }

    .filter-container .sort-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .filter-container .sort-container label {
      margin-right: 10px;
    }

    .filter-container .sort-container select {
      width: 200px;
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .container-main {
        flex-direction: column;
        align-items: center;
      }

      .comerciante-recuadro {
        margin-right: 0;
        margin-bottom: 20px;
      }

      .chart-box {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="wrapper-wide">
    <!-- Inicio del encabezado -->
    <header class="header">
      <div class="logo">
        <a href="index.html"><img class="img-responsive" src="image/logo.png" title="Click Store" alt="Click Store" /></a>
      </div>
      <div class="nav-links">
        <span id="nombre-comerciante" class="comerciante-info"></span>
        <a href="#" id="logout-btn">Cerrar Sesión</a>
      </div>
    </header>
    <!-- Encabezado End -->

    <!-- Contenedor principal con comerciante y productos -->
    <div class="container-main">
      <!-- Información del Comerciante -->
      <div class="comerciante-recuadro">
        <h2>Información del Comerciante</h2>
        <div id="comerciante-info"></div>

        <!-- Dashboard del Comerciante -->
        <div class="dashboard-item">
          <h4>Total de Productos</h4>
          <p id="total-productos"></p>
        </div>
        <div class="dashboard-item">
          <h4>Producto más Caro</h4>
          <p id="producto-mas-caro"></p>
        </div>
        <div class="dashboard-item">
          <h4>Total de Productos Similares</h4>
          <p id="total-productos-similares"></p>
        </div>
      </div>

      <!-- Contenedor de la lista de productos -->
      <div class="product-list">
        <!-- Botón de Subir Artículo -->
        <div class="text-right">
          <button id="subir-producto-btn" onclick="redirigirAProductos()">Subir Artículo</button>
        </div>
        <h1>Mis Productos</h1>
        <!-- Filtros -->
        <div class="filter-container">
          <input type="text" id="search-bar" placeholder="Buscar producto..." class="form-control"
            onkeyup="filtrarProductos()">

          <div class="sort-container">
            <label for="ordenar">Ordenar por:</label>
            <select id="ordenar" class="form-control" onchange="ordenarProductos()">
              <option value="nombre">Nombre</option>
              <option value="precio-asc">Precio: Menor a Mayor</option>
              <option value="precio-desc">Precio: Mayor a Menor</option>
            </select>
          </div>
        </div>

        <div id="productos-lista">
          <!-- Los productos se cargarán aquí -->
        </div>

        <!-- Recomendaciones -->
        <h1>Tal vez te interese subir estos artículos similares</h1>
        <div id="productos-recomendados"></div>
      </div>
    </div>

    <!-- Gráficos de ventas -->
    <div class="dashboard-charts container">
      <div class="chart-box">
        <h2>Artículos Más Vendidos</h2>
        <canvas id="topProductsChart"></canvas>
      </div>
      <div class="chart-box">
        <h2>Ventas Mensuales</h2>
        <canvas id="monthlySalesChart"></canvas>
      </div>
    </div>

    <!-- Modal para editar producto -->
    <div class="modal fade" id="editarProductoModal" tabindex="-1" role="dialog"
      aria-labelledby="editarProductoModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="editarProductoModalLabel">Editar Producto</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
              onclick="$('#editarProductoModal').modal('hide');"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="producto-id">
            <div class="form-group">
              <label for="producto-nombre">Nombre del Producto</label>
              <input type="text" class="form-control" id="producto-nombre">
            </div>
            <div class="form-group">
              <label for="producto-descripcion">Descripción</label>
              <textarea class="form-control" id="producto-descripcion"></textarea>
            </div>
            <div class="form-group">
              <label for="producto-precio">Precio</label>
              <input type="number" class="form-control" id="producto-precio">
            </div>
            <div class="form-group">
              <label for="producto-foto">URL de la Foto</label>
              <input type="text" class="form-control" id="producto-foto">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" onclick="eliminarProducto()">Eliminar</button>
            <button type="button" class="btn btn-primary" onclick="guardarCambiosProducto()">Guardar Cambios</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Agregar Producto en Recomendaciones-->
    <div class="modal fade" id="agregarProductoModal" tabindex="-1" role="dialog"
      aria-labelledby="agregarProductoModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="agregarProductoModalLabel">Agregar Producto</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
              onclick="$('#agregarProductoModal').modal('hide');"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="nuevo-producto-id">
            <div class="form-group">
              <label for="nuevo-producto-nombre">Nombre del Producto</label>
              <input type="text" class="form-control" id="nuevo-producto-nombre">
            </div>
            <div class="form-group">
              <label for="nuevo-producto-descripcion">Descripción</label>
              <textarea class="form-control" id="nuevo-producto-descripcion"></textarea>
            </div>
            <div class="form-group">
              <label for="nuevo-producto-precio">Precio</label>
              <input type="number" class="form-control" id="nuevo-producto-precio">
            </div>
            <div class="form-group">
              <label for="nuevo-producto-foto">URL de la Foto</label>
              <input type="text" class="form-control" id="nuevo-producto-foto">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="agregarProducto()">Confirmar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pie de Página Inicio -->
    <footer id="footer">
      <p>&copy; 2024 Click Store | <a href="index.html">Inicio</a> | <a href="contact.html">Contacto</a></p>
    </footer>

    <!-- Scripts -->
    <script src="js/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <!-- Asegúrate de que jQuery se cargue antes de este script -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const nombreComerciante = sessionStorage.getItem('nombre');
        const idComerciante = sessionStorage.getItem('id');
        const tipoUsuario = sessionStorage.getItem('tipo');

        if (tipoUsuario !== 'comerciante' || !nombreComerciante || !idComerciante) {
          alert('Por favor, inicie sesión como comerciante.');
          window.location.href = 'login.html';
        }

        document.getElementById('nombre-comerciante').innerHTML = `Hola, ${nombreComerciante}`;

        fetchProductos(); // Cargar los productos del comerciante
        fetchComercianteInfo(); // Cargar la información del comerciante

        document.getElementById('logout-btn').addEventListener('click', function () {
          sessionStorage.clear();
          window.location.href = 'login.html';
        });

        // Cargar recomendaciones
        cargarRecomendaciones();
      });

      function fetchProductos() {
        const comercianteId = sessionStorage.getItem('id');
        fetch(`http://localhost:3000/api/productos/comerciante/${comercianteId}`)
          .then(response => response.json())
          .then(data => {
            displayProductos(data);
            actualizarDashboard(data);
            simularGraficos(data);
          })
          .catch(err => console.error('Error fetching productos:', err));
      }

      function fetchComercianteInfo() {
        const comercianteId = sessionStorage.getItem('id');
        fetch(`http://localhost:3000/api/comerciantes/${comercianteId}`)
          .then(response => response.json())
          .then(data => displayComercianteInfo(data))
          .catch(err => console.error('Error fetching comerciante info:', err));
      }

      function displayComercianteInfo(comerciante) {
        const comercianteInfo = document.getElementById('comerciante-info');
        comercianteInfo.innerHTML = `
          <h3>${comerciante.nombre}</h3>
          <p><strong>Email:</strong> ${comerciante.email}</p>
          <p><strong>Dirección:</strong> ${comerciante.direccion}</p>
          <p><strong>Teléfono:</strong> ${comerciante.telefono}</p>
          <p><strong>Descripción:</strong> ${comerciante.descripcion}</p>
          <p><strong>Enlace a la tienda:</strong> <a href="${comerciante.enlace_tienda}" target="_blank">${comerciante.enlace_tienda}</a></p>
        `;
      }

      function displayProductos(productos) {
        const container = document.getElementById('productos-lista');
        container.innerHTML = '';
        productos.forEach(producto => {
          const item = document.createElement('div');
          item.className = 'product-item';
          item.innerHTML = `
            <img src="${producto.foto_url}" alt="${producto.nombre}" class="product-image">
            <h3>${producto.nombre}</h3>
            <p>${producto.descripcion.substring(0, 60)}...</p>
            <p class="price">₲${Number(producto.precio).toLocaleString('es-PY')}</p>
            <button class="ver-mas" onclick="editarProducto(${producto.id})">Editar Producto</button>
          `;
          container.appendChild(item);
        });
      }

      function actualizarDashboard(productos) {
        const totalProductos = productos.length;
        const productoMasCaro = productos.reduce((max, producto) => producto.precio > max.precio ? producto : max, productos[0]);

        document.getElementById('total-productos').textContent = totalProductos;
        if (productoMasCaro) {
          document.getElementById('producto-mas-caro').textContent = `${productoMasCaro.nombre} - ₲${Number(productoMasCaro.precio).toLocaleString('es-PY')}`;
        } else {
          document.getElementById('producto-mas-caro').textContent = 'No hay productos';
        }
      }

      function editarProducto(id) {
        fetch(`http://localhost:3000/api/productos/${id}`)
          .then(response => response.json())
          .then(data => {
            document.getElementById('producto-id').value = data.id;
            document.getElementById('producto-nombre').value = data.nombre;
            document.getElementById('producto-descripcion').value = data.descripcion;
            document.getElementById('producto-precio').value = data.precio;
            document.getElementById('producto-foto').value = data.foto_url;
            $('#editarProductoModal').modal('show');
          })
          .catch(err => console.error('Error al cargar producto para editar:', err));
      }

      function guardarCambiosProducto() {
        const productoId = document.getElementById('producto-id').value;
        const nombre = document.getElementById('producto-nombre').value;
        const descripcion = document.getElementById('producto-descripcion').value;
        const precio = document.getElementById('producto-precio').value;
        const fotoUrl = document.getElementById('producto-foto').value;
        const idComerciante = sessionStorage.getItem('id'); // Obtener el `id_comerciante`

        fetch(`http://localhost:3000/api/productos/${productoId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            nombre: nombre,
            descripcion: descripcion,
            precio: parseFloat(precio),
            foto_url: fotoUrl,
            id_comerciante: idComerciante, // Incluir el `id_comerciante`
          }),
        })
          .then(response => response.json())
          .then(data => {
            if (data.producto) {
              alert('Producto actualizado exitosamente');
              $('#editarProductoModal').modal('hide');
              fetchProductos();
            } else {
              alert('Hubo un error al actualizar el producto');
            }
          })
          .catch(err => console.error('Error al actualizar producto:', err));
      }

      function eliminarProducto() {
        const productoId = document.getElementById('producto-id').value;

        fetch(`http://localhost:3000/api/productos/${productoId}`, {
          method: 'DELETE'
        })
          .then(response => {
            if (response.ok) {
              alert('Producto eliminado exitosamente');
              $('#editarProductoModal').modal('hide');
              fetchProductos();
            } else {
              alert('Error al eliminar el producto');
            }
          })
          .catch(err => console.error('Error eliminando producto:', err));
      }

      function redirigirAProductos() {
        window.location.href = 'productos.html';
      }

      function simularGraficos(productos) {
        const nombresProductos = productos.map(p => p.nombre);
        const ventasSimuladas = productos.map(() => Math.floor(Math.random() * 30) + 5);

        // Obtener el valor de la variable CSS
        const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();

        const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
        new Chart(topProductsCtx, {
          type: 'bar',
          data: {
            labels: nombresProductos,
            datasets: [{
              label: 'Ventas',
              data: ventasSimuladas,
              backgroundColor: primaryColor
            }]
          }
        });

        const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
        const ventasMensuales = Array.from({ length: 6 }, () => Math.floor(Math.random() * 50000) + 50000);
        new Chart(monthlySalesCtx, {
          type: 'line',
          data: {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
            datasets: [{
              label: 'Ventas en ₲',
              data: ventasMensuales,
              backgroundColor: 'rgba(255, 153, 0, 0.2)',
              borderColor: primaryColor,
              borderWidth: 2
            }]
          }
        });
      }

      function filtrarProductos() {
        const searchQuery = document.getElementById('search-bar').value.toLowerCase();
        const productos = document.querySelectorAll('.product-item');

        productos.forEach(producto => {
          const nombreProducto = producto.querySelector('h3').textContent.toLowerCase();
          if (nombreProducto.includes(searchQuery)) {
            producto.style.display = 'inline-block';
          } else {
            producto.style.display = 'none';
          }
        });
      }

      function ordenarProductos() {
        const ordenarPor = document.getElementById('ordenar').value;
        const listaProductos = document.getElementById('productos-lista');
        const productos = Array.from(listaProductos.getElementsByClassName('product-item'));

        let productosOrdenados;

        if (ordenarPor === 'nombre') {
          productosOrdenados = productos.sort((a, b) => {
            const nombreA = a.querySelector('h3').textContent.toLowerCase();
            const nombreB = b.querySelector('h3').textContent.toLowerCase();
            return nombreA.localeCompare(nombreB);
          });
        } else if (ordenarPor === 'precio-asc') {
          productosOrdenados = productos.sort((a, b) => {
            const precioA = parseFloat(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            const precioB = parseFloat(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            return precioA - precioB;
          });
        } else if (ordenarPor === 'precio-desc') {
          productosOrdenados = productos.sort((a, b) => {
            const precioA = parseFloat(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            const precioB = parseFloat(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            return precioB - precioA;
          });
        }

        listaProductos.innerHTML = '';
        productosOrdenados.forEach(producto => {
          listaProductos.appendChild(producto);
        });
      }

      function cargarRecomendaciones() {
        axios.get('http://127.0.0.1:5000/recomendaciones')
          .then(response => {
            const recomendaciones = response.data;
            mostrarRecomendaciones(recomendaciones);
            mostrarTotalProductosSimilares(recomendaciones);
          })
          .catch(error => {
            console.error('Error al cargar recomendaciones:', error);
          });
      }

      function mostrarRecomendaciones(recomendaciones) {
        const contenedor = document.getElementById('productos-recomendados');
        contenedor.innerHTML = '';
        const limite = 6;
        const recomendacionesLimitadas = recomendaciones.slice(0, limite);

        recomendacionesLimitadas.forEach(recomendacion => {
          const productoDiv = document.createElement('div');
          productoDiv.classList.add('product-item');

          productoDiv.innerHTML = `
            <img src="${recomendacion.foto_url}" alt="${recomendacion.nombre}" class="product-image">
            <h3>${recomendacion.nombre}</h3>
            <p>${recomendacion.descripcion}</p>
            <p class="price">₲${Number(recomendacion.precio).toLocaleString('es-PY')}</p>
            <button class="ver-mas" onclick='mostrarAgregarProductoModal(${JSON.stringify(recomendacion)})'>Agregar Producto</button>
          `;

          contenedor.appendChild(productoDiv);
        });
      }

      function mostrarTotalProductosSimilares(recomendaciones) {
        const totalProductosSimilares = recomendaciones.length;
        document.getElementById('total-productos-similares').textContent = totalProductosSimilares;
      }

      function mostrarAgregarProductoModal(producto) {
        document.getElementById('nuevo-producto-id').value = producto.id;
        document.getElementById('nuevo-producto-nombre').value = producto.nombre;
        document.getElementById('nuevo-producto-descripcion').value = producto.descripcion;
        document.getElementById('nuevo-producto-precio').value = producto.precio;
        document.getElementById('nuevo-producto-foto').value = producto.foto_url;

        $('#agregarProductoModal').modal('show');
      }

      function agregarProducto() {
        const nombre = document.getElementById('nuevo-producto-nombre').value;
        const descripcion = document.getElementById('nuevo-producto-descripcion').value;
        const precio = document.getElementById('nuevo-producto-precio').value;
        const fotoUrl = document.getElementById('nuevo-producto-foto').value;
        const comercianteId = sessionStorage.getItem('id');

        if (!nombre || !descripcion || !precio || !fotoUrl || !comercianteId) {
          alert('Por favor completa todos los campos antes de agregar el producto.');
          return;
        }

        axios.post('http://localhost:3000/api/productos', {
          nombre: nombre,
          descripcion: descripcion,
          precio: parseFloat(precio),
          id_comerciante: comercianteId,
          foto_url: fotoUrl
        })
          .then(response => {
            alert('Producto agregado exitosamente');
            $('#agregarProductoModal').modal('hide');
            fetchProductos();
          })
          .catch(error => {
            console.error('Error al agregar el producto:', error);
            alert('Hubo un error al agregar el producto');
          });
      }
    </script>
  </div>
</body>

</html>
