<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Click Store - Panel del Comerciante</title>
  <!-- CSS Parte Inicio -->
  <link rel="stylesheet" type="text/css" href="js/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.carousel.css" />
  <link rel="stylesheet" type="text/css" href="css/owl.transitions.css" />
  <link rel="stylesheet" type="text/css" href="css/responsive.css" />
  <link rel="stylesheet" type="text/css" href="css/estilop.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans' type='text/css'>
  <!-- CSS Parte Fin -->
  <!-- Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Axios library -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- jQuery script -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Owl Carousel CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />
  <!-- Owl Carousel JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<!-- Swiper CSS -->
<!-- Incluir los estilos CSS de Swiper -->
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

<!-- Swiper JS -->
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>


  <style>
    /* Variables de colores para fácil modificación */
    :root {
      --primary-color: #ff6f61;
      --secondary-color: #ff9e80;
      --text-color: #333;
      --background-color: #f9f9f9;
      --font-family: 'Open Sans', sans-serif;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #ffffff;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e5e5;
    }

    .logo img {
      max-width: 180px;
    }

#nombre-comerciante {
    color: #5a4e4e; 
    font-weight: bold; 
    font-size: 16px; 
    margin-left: 10px; 
}

    .nav-links {
      display: flex;
      align-items: center;
    }

    .nav-links .comerciante-info {
      font-size: 14px;
      color: var(--text-color);
      font-weight: bold;
      margin-right: 20px;
    }

    .nav-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: bold;
    }

    .nav-links a:hover {
      text-decoration: underline;
    }

    .container-main {
      display: flex;
      flex-wrap: wrap;
      margin: 20px;
    }

    .comerciante-recuadro {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      margin-right: 20px;
      width: 300px;
    }

    .comerciante-recuadro h2 {
      font-size: 24px;
      color: var(--primary-color);
      margin-bottom: 20px;
    }

    .comerciante-recuadro p {
      font-size: 16px;
      color: #555;
      margin-bottom: 10px;
    }

    .dashboard-item {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #fff7f5;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .dashboard-item h4 {
      font-size: 18px;
      color: var(--primary-color);
      margin-bottom: 5px;
    }

    .dashboard-item p {
      font-size: 16px;
      color: var(--text-color);
    }

    .product-list {
      flex: 1;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-top: 20px;
    }

    .product-list h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .product-item {
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 15px;
      text-align: center;
      width: calc(33.33% - 40px); 
      height: 450px; 
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      display: inline-block;
      vertical-align: top;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-right: 15px; 
    }


    .product-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    .product-item h3 {
      font-size: 18px;
      height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--text-color);
    }

    .product-item p {
      font-size: 14px;
      color: #555;
      height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-item .price {
      font-size: 18px;
      color: #28a745;
      margin-top: 10px;
      font-weight: bold;
    }

    .product-item .ver-mas {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .product-item .ver-mas:hover {
      background-color: #e65b54;
    }

    #subir-producto-btn {
      background-color: var(--primary-color);
      color: #fff;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
      border-radius: 5px;
      padding: 10px 20px;
      border: none;
    }

    #subir-producto-btn:hover {
      background-color: #e65b54;
    }

    footer {
      background-color: #333;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      bottom: 0;
      width: 100%;
      margin-top: 40px;
    }

    footer a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .dashboard-charts {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .chart-box {
      width: 48%;
      margin-bottom: 30px;
    }

    .chart-box h2 {
      font-size: 24px;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    canvas {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
    }

    #productos-recomendados {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
      max-width: 100%;
    }

    .producto {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      width: 200px;
      text-align: center;
      margin-right: 10px;
    }

    .producto:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .producto img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .producto p {
      margin: 5px 0;
      font-size: 14px;
      color: #333;
    }

    .producto .precio {
      font-size: 16px;
      font-weight: bold;
      color: #28a745;
    }

    .producto .calificacion {
      font-size: 14px;
      color: #666;
    }

    .ver-mas {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .ver-mas:hover {
      background-color: #e65b54;
    }

    .filter-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      width: 100%;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .filter-container input.form-control {
      width: 100%;
      max-width: 400px;
      margin-bottom: 10px;
    }

    .filter-container .sort-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .filter-container .sort-container label {
      margin-right: 10px;
    }

    .filter-container .sort-container select {
      width: 200px;
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .container-main {
        flex-direction: column;
        align-items: center;
      }

      .comerciante-recuadro {
        margin-right: 0;
        margin-bottom: 20px;
      }

      .chart-box {
        width: 100%;
      }
    }

.swiper-container {
  width: 90%; /* Aumenta el ancho del contenedor al 90% */
  height: auto;
  min-height: 30px;
  margin: 0 auto; /* Centrar el carrusel */
  overflow: hidden;
}

.swiper-slide {
  display: flex;
  justify-content: center;
  align-items: center;
  height: auto;
}

.product-item-carousel {
  width: 410px; /* Aumentar el ancho del producto para que se vea mejor */
  padding: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  background-color: #fff;
  border-radius: 10px;
  text-align: center;
}

.product-item-carousel img {
  width: 60%; 
  height: 220px; /* Ajustar altura para mayor visibilidad */
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}

.product-item-carousel h3 {
  font-size: 18px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 5px;
}

.product-item-carousel p {
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 5px;
}

.product-item-carousel .price {
  font-size: 16px;
  color: #28a745;
  font-weight: bold;
}

.swiper-button-next, .swiper-button-prev {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 50%;
  border: 1px solid #ff6f61;
  color: #ff6f61;
  cursor: pointer;
  width: 50px; /* Aumenta el tamaño de los botones para mejor visibilidad */
  height: 50px;
  z-index: 10;
}

.swiper-button-next {
  right: 15px;
}

.swiper-button-prev {
  left: 15px;
}
/* Ajustes para la vista móvil */
@media (max-width: 768px) {
    .product-item {
        width: calc(50% - 10px);
    }
}

@media (max-width: 480px) {
    .product-item {
        width: 100%;
    }
}
/* Ajuste general del modal */
.modal-content {
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    padding: 20px;
    max-width: 600px;
    margin: auto;
}

/* Ajuste del header */
.modal-header h4 {
    font-weight: bold;
    color: var(--primary-color);
    margin: 0;
}

/* Ajuste del form-group para alinear los campos */
.form-group {
    margin-bottom: 15px;
}

/* Estilo específico para el select de categoría */
#producto-categoria {
    width: 100%; /* Asegura que ocupe todo el espacio del form-group */
    max-width: 400px; /* Limita el ancho máximo */
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    background-color: #fff;
    font-size: 16px;
    transition: border-color 0.3s ease;
}

#producto-categoria:focus {
    border-color: var(--primary-color);
    outline: none;
}

/* Ajuste general del modal */
.modal-content {
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    padding: 20px;
    max-width: 600px;
    margin: auto;
}

/* Alinear y dar espacio uniforme entre los elementos */
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    font-weight: bold;
    margin-bottom: 5px;
    display: block;
}

/* Asegurar que todos los inputs, selects y textarea se alineen */
.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    box-sizing: border-box; /* Asegura que el padding no desajuste el tamaño */
    font-size: 16px;
}

/* Ajuste del select para igualarlo con los inputs */
.form-group select {
    appearance: none; /* Eliminar estilos predeterminados del navegador */
    height: 42px; /* Asegurar que tenga la misma altura que los inputs */
}

/* Ajustes del modal-footer */
.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-footer .btn {
    border-radius: 5px;
    padding: 10px 15px;
    font-size: 16px;
}

.modal-footer .btn-primary {
    background-color: var(--primary-color);
    border: none;
    transition: background-color 0.3s ease;
}

.modal-footer .btn-primary:hover {
    background-color: #e65b54;
}



/* Contenedor de productos */
#productos-lista {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    margin-top: 20px;
}

/* Imagen del producto */
.product-image {
    width: 100%;
    height: 150px;
    object-fit: contain;
    margin-bottom: 10px;
    border-radius: 8px;
}

/* Nombre del producto */
.product-item h3 {
    font-size: 18px;
    margin: 10px 0;
}

/* Descripción del producto */
.product-item p {
    font-size: 14px;
    color: #555;
}

/* Precio del producto */
.product-item .price {
    font-size: 16px;
    font-weight: bold;
    color: #b12704;
    margin: 10px 0;
}

/* Estilo del stock */
.product-item .stock {
    font-size: 14px;
    font-weight: bolder;
    text-align: center;
    margin-top: 10%;
    color: #6d6969;
    margin: 1px 0;
}


/* Responsividad */
@media (max-width: 768px) {
    .product-item {
        width: calc(50% - 20px); /* 2 productos por fila */
    }
}

@media (max-width: 480px) {
    .product-item {
        width: 100%; /* 1 producto por fila */
    }
}

#producto-categoria {
    display: block; /* Asegura que ocupe todo el bloque */
    width: 100%;  /* Ocupa todo el ancho disponible */
    max-width: 100%; /* No exceder el contenedor */
}

  </style>
</head>

<body>
  <div class="wrapper-wide">
    <!-- Inicio del encabezado -->
    <header class="header">
      <div class="logo">
        <a href="index.html"><img class="img-responsive" src="image/logo.png" title="Click Store" alt="Click Store" /></a>
      </div>
      <div class="nav-links">
        <span id="nombre-comerciante" class="comerciante-info"></span>
        <a href="#" id="logout-btn">Cerrar Sesión</a>
      </div>
    </header>
    <!-- Encabezado End -->

    <!-- Contenedor principal con comerciante y productos -->
    <div class="container-main">
      <!-- Información del Comerciante -->
      <div class="comerciante-recuadro">
        <h2>Información del Comerciante</h2>
        <div id="comerciante-info"></div>

        <!-- Dashboard del Comerciante -->
        <div class="dashboard-item">
          <h4>Total de Productos</h4>
          <p id="total-productos"></p>
        </div>
        <div class="dashboard-item">
          <h4>Producto más Caro</h4>
          <p id="producto-mas-caro"></p>
        </div>
        <div class="dashboard-item">
          <h4>Total de Productos Recomendados</h4>
          <p id="total-productos-similares"></p>
        </div>
        <div class="dashboard-item">
          <h4>Total de Productos Sin Stock</h4>
          <p id="total-productos-sin-stock">Cargando...</p>
        </div>
        
      </div>

      <!-- Contenedor de la lista de productos -->
      <div class="product-list">
        <!-- Botón de Subir Artículo -->
        <div class="text-right">
          <button id="subir-producto-btn" onclick="redirigirAProductos()">Subir Artículo</button>
        </div>
        <h1>Mis Productos</h1>
        <!-- Filtros -->
        <div class="filter-container">
          <input type="text" id="search-bar" placeholder="Buscar producto..." class="form-control"
            onkeyup="filtrarProductos()">

          <div class="sort-container">
            <label for="ordenar">Ordenar por:</label>
            <select id="ordenar" class="form-control" onchange="ordenarProductos()">
              <option value="nombre">Nombre</option>
              <option value="precio-asc">Precio: Menor a Mayor</option>
              <option value="precio-desc">Precio: Mayor a Menor</option>
            </select>
          </div>
        </div>

        <div id="productos-lista">
          <!-- Los productos se cargarán aquí -->
        </div>
      </div>
    </div> 
      <!-- Swiper Carousel para productos recomendados -->
    <div class="product-list">
      <h1>Te pueden interesar estos artículos</h1>
      <div class="swiper-container" id="productos-recomendados">
        <div class="swiper-wrapper">
          <!-- Los productos recomendados se cargarán aquí dinámicamente -->
        </div>
        <!-- Botones de navegación -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <!-- Paginación -->
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </div>
    <!-- Gráficos de ventas -->
    <div class="dashboard-charts container">
      <div class="chart-box">
        <h2>Artículos Más Vendidos</h2>
        <canvas id="topProductsChart"></canvas>
      </div>
      <div class="chart-box">
        <h2>Ventas Mensuales</h2>
        <canvas id="monthlySalesChart"></canvas>
      </div>
    </div>
  </div>
<!-- Modal para editar producto -->
<div class="modal fade" id="editarProductoModal" tabindex="-1" role="dialog"
  aria-labelledby="editarProductoModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="editarProductoModalLabel">Editar Producto</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
          onclick="$('#editarProductoModal').modal('hide');">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <input type="hidden" id="producto-id">
        <div class="form-group">
          <label for="producto-nombre">Nombre del Producto</label>
          <input type="text" class="form-control" id="producto-nombre">
        </div>
        <div class="form-group">
          <label for="producto-descripcion">Descripción</label>
          <textarea class="form-control" id="producto-descripcion"></textarea>
        </div>
        <div class="form-group">
          <label for="producto-precio">Precio</label>
          <input type="number" class="form-control" id="producto-precio">
        </div>
        <div class="form-group">
          <label for="producto-foto">URL de la Foto</label>
          <input type="text" class="form-control" id="producto-foto">
        </div>
        <div class="form-group">
          <label for="stock">Stock</label>
          <input type="number" id="stock" name="stock" class="form-control" min="0" required>
        </div>
        <div class="form-group">
          <label for="producto-categoria">Categoría</label>
          <select class="form-control" id="producto-categoria">
            <option value="" disabled>Selecciona una categoría</option>
            <option value="Electrónica">Electrónica</option>
            <option value="Informática">Informática</option>
            <option value="Ropa">Ropa</option>
            <option value="Automóviles">Automóviles</option>
            <option value="Belleza">Belleza</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" onclick="eliminarProducto()">Eliminar</button>
        <button type="button" class="btn btn-primary" onclick="guardarCambiosProducto()">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>

    <!-- Pie de Página Inicio -->
    <footer id="footer">
      <p>&copy; 2024 Click Store | <a href="index.html">Inicio</a> | <a href="contact.html">Contacto</a></p>
    </footer>

    <!-- Scripts -->
    <script src="js/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="js/api.js"></script>

    <!-- Script Principal -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const nombreComerciante = sessionStorage.getItem('nombre');
        if (nombreComerciante) {
          document.getElementById('nombre-comerciante').innerHTML = `Hola, ${nombreComerciante}`;
        } else {
          window.location.href = 'login.html';
        }

        fetchProductos(); // Cargar los productos del comerciante
        fetchComercianteInfo(); // Cargar la información del comerciante

        document.getElementById('logout-btn').addEventListener('click', function () {
          sessionStorage.clear();
          window.location.href = 'login.html';
        });

        // Cargar recomendaciones
        cargarRecomendaciones();
      });

      function fetchProductos() {
        const comercianteId = sessionStorage.getItem('Id');
        fetch(`https://tcc-api-nodejs.onrender.com/api/productos?comercianteId=${comercianteId}`)
          .then(response => response.json())
          .then(data => {
            displayProductos(data);
            actualizarDashboard(data);
            simularGraficos(data);
          })
          .catch(err => console.error('Error fetching productos:', err));
      }

      function fetchComercianteInfo() {
        const comercianteId = sessionStorage.getItem('Id');
        fetch(`https://tcc-api-nodejs.onrender.com/api/comerciantes/${comercianteId}`)
          .then(response => response.json())
          .then(data => displayComercianteInfo(data))
          .catch(err => console.error('Error fetching comerciante info:', err));
      }

      function displayComercianteInfo(comerciante) {
        const comercianteInfo = document.getElementById('comerciante-info');
        comercianteInfo.innerHTML = `
          <h3>${comerciante.nombre}</h3>
          <p><strong>Email:</strong> ${comerciante.email}</p>
          <p><strong>Dirección:</strong> ${comerciante.direccion}</p>
          <p><strong>Teléfono:</strong> ${comerciante.telefono}</p>
          <p><strong>Descripción:</strong> ${comerciante.descripcion}</p>
          <p><strong>Enlace a la tienda:</strong> <a href="${comerciante.enlace_tienda}" target="_blank">${comerciante.enlace_tienda}</a></p>
        `;
      }
      function displayProductos(productos) { 
    const container = document.getElementById('productos-lista');
    container.innerHTML = '';

    productos.forEach(producto => {
        const item = document.createElement('div');
        item.className = 'product-item';
        item.innerHTML = `
            <img src="${producto.foto_url}" alt="${producto.nombre}" class="product-image">
            <h3>${producto.nombre}</h3>
            <p>${producto.descripcion.substring(0, 60)}...</p>
            <p class="price">₲${Number(producto.precio).toLocaleString('es-PY')}</p>
            <p class="stock ${producto.stock > 0 ? 'in-stock' : 'out-of-stock'}">
                Stock: ${producto.stock}
            </p>
            <button class="ver-mas" onclick="editarProducto(${producto.id})">Editar Producto</button>
        `;
        container.appendChild(item);
    });
}



      function actualizarDashboard(productos) {
        const totalProductos = productos.length;
        const productoMasCaro = productos.reduce((max, producto) => producto.precio > max.precio ? producto : max, productos[0]);

        document.getElementById('total-productos').textContent = totalProductos;
        if (productoMasCaro) {
          document.getElementById('producto-mas-caro').textContent = `${productoMasCaro.nombre} - ₲${Number(productoMasCaro.precio).toLocaleString('es-PY')}`;
        } else {
          document.getElementById('producto-mas-caro').textContent = 'No hay productos';
        }
      }


      function editarProducto(id) {
      fetch(`https://tcc-api-nodejs.onrender.com/api/productos/${id}`)
        .then(response => response.json())
        .then(data => {
          // Cargar los datos del producto en los campos del modal
          document.getElementById('producto-id').value = data.id;
          document.getElementById('producto-nombre').value = data.nombre;
          document.getElementById('producto-descripcion').value = data.descripcion;
          document.getElementById('producto-precio').value = data.precio;
          document.getElementById('producto-foto').value = data.foto_url;
          document.getElementById('stock').value = data.stock;

          const selectCategoria = document.getElementById('producto-categoria');

          // Intentar seleccionar la categoría guardada
          const categoriaGuardada = data.categoria || "";
          const optionToSelect = Array.from(selectCategoria.options).find(
            option => option.value.toLowerCase() === categoriaGuardada.toLowerCase()
          );

          if (optionToSelect) {
            // Si la opción existe, seleccionarla
            selectCategoria.value = optionToSelect.value;
          } else {
            // Si no coincide, seleccionar la opción por defecto
            selectCategoria.value = "";
            console.warn(`La categoría "${categoriaGuardada}" no coincide con ninguna opción disponible.`);
          }

          $('#editarProductoModal').modal('show');
        })
        .catch(err => console.error('Error al cargar producto para editar:', err));
    }


function guardarCambiosProducto() {
  const productoId = document.getElementById('producto-id').value;
  const nombre = document.getElementById('producto-nombre').value;
  const descripcion = document.getElementById('producto-descripcion').value;
  const precio = parseFloat(document.getElementById('producto-precio').value);
  const fotoUrl = document.getElementById('producto-foto').value;
  const stock = parseInt(document.getElementById('stock').value);
  const categoria = document.getElementById('producto-categoria').value; // Obtener la categoría seleccionada
  const idComerciante = sessionStorage.getItem('Id');

  fetch(`https://tcc-api-nodejs.onrender.com/api/productos/${productoId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      nombre,
      descripcion,
      precio,
      foto_url: fotoUrl,
      stock,
      categoria, // Enviar la categoría seleccionada
      id_comerciante: idComerciante,
    }),
  })
    .then(response => response.json())
    .then(data => {
      if (data.producto) {
        alert('Producto actualizado exitosamente');
        $('#editarProductoModal').modal('hide');
        fetchProductos(); // Recargar los productos
      } else {
        alert('Hubo un error al actualizar el producto');
      }
    })
    .catch(err => console.error('Error al actualizar producto:', err));
}


    function eliminarProducto() {
      const productoId = document.getElementById('producto-id').value;

      fetch(`https://tcc-api-nodejs.onrender.com/api/productos/${productoId}`, {
        method: 'DELETE',
      })
        .then(response => {
          if (response.ok) {
            alert('Producto eliminado exitosamente');
            $('#editarProductoModal').modal('hide');
            fetchProductos();
          } else {
            alert('Error al eliminar el producto');
          }
        })
        .catch(err => console.error('Error eliminando producto:', err));
    }


      function redirigirAProductos() {
        window.location.href = 'productos.html';
      }

      function simularGraficos(productos) {
        const nombresProductos = productos.map(p => p.nombre);
        const ventasSimuladas = productos.map(() => Math.floor(Math.random() * 30) + 5);

        // Obtener el valor de la variable CSS
        const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();

        const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
        new Chart(topProductsCtx, {
          type: 'bar',
          data: {
            labels: nombresProductos,
            datasets: [{
              label: 'Ventas',
              data: ventasSimuladas,
              backgroundColor: primaryColor
            }]
          }
        });

        const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
        const ventasMensuales = Array.from({ length: 6 }, () => Math.floor(Math.random() * 50000) + 50000);
        new Chart(monthlySalesCtx, {
          type: 'line',
          data: {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
            datasets: [{
              label: 'Ventas en ₲',
              data: ventasMensuales,
              backgroundColor: 'rgba(255, 153, 0, 0.2)',
              borderColor: primaryColor,
              borderWidth: 2
            }]
          }
        });
      }

      function filtrarProductos() {
        const searchQuery = document.getElementById('search-bar').value.toLowerCase();
        const productos = document.querySelectorAll('.product-item');

        productos.forEach(producto => {
          const nombreProducto = producto.querySelector('h3').textContent.toLowerCase();
          if (nombreProducto.includes(searchQuery)) {
            producto.style.display = 'inline-block';
          } else {
            producto.style.display = 'none';
          }
        });
      }

      function ordenarProductos() {
        const ordenarPor = document.getElementById('ordenar').value;
        const listaProductos = document.getElementById('productos-lista');
        const productos = Array.from(listaProductos.getElementsByClassName('product-item'));

        let productosOrdenados;

        if (ordenarPor === 'nombre') {
          productosOrdenados = productos.sort((a, b) => {
            const nombreA = a.querySelector('h3').textContent.toLowerCase();
            const nombreB = b.querySelector('h3').textContent.toLowerCase();
            return nombreA.localeCompare(nombreB);
          });
        } else if (ordenarPor === 'precio-asc') {
          productosOrdenados = productos.sort((a, b) => {
            const precioA = parseFloat(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            const precioB = parseFloat(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            return precioA - precioB;
          });
        } else if (ordenarPor === 'precio-desc') {
          productosOrdenados = productos.sort((a, b) => {
            const precioA = parseFloat(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            const precioB = parseFloat(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
            return precioB - precioA;
          });
        }

        listaProductos.innerHTML = '';
        productosOrdenados.forEach(producto => {
          listaProductos.appendChild(producto);
        });
      }
      document.addEventListener('DOMContentLoaded', function () {
    const nombreComerciante = sessionStorage.getItem('nombre');
    if (nombreComerciante) {
      document.getElementById('nombre-comerciante').innerHTML = `Hola, ${nombreComerciante}`;
    } else {
      window.location.href = 'login.html';
    }

    fetchProductos(); // Cargar los productos del comerciante
    fetchComercianteInfo(); // Cargar la información del comerciante

    document.getElementById('logout-btn').addEventListener('click', function () {
      sessionStorage.clear();
      window.location.href = 'login.html';
    });

    // Cargar recomendaciones
     cargarRecomendaciones();
  });

  document.addEventListener('DOMContentLoaded', function () {
  const comercianteId = sessionStorage.getItem('Id');
  if (comercianteId) {
    cargarRecomendaciones(comercianteId);
  } else {
    console.error('Error: comercianteId no encontrado en sessionStorage');
  }
});


function almacenarComercianteId(comercianteId) {
    if (comercianteId) {
        sessionStorage.setItem('Id', comercianteId); 
    }
}

function mostrarTotalProductosSimilares(total) {
    document.getElementById('total-productos-similares').textContent = total;
}


// Cargar recomendaciones
function cargarRecomendaciones(comercianteId) {
  axios.get(`http://127.0.0.1:5002/recomendaciones?comercianteId=${comercianteId}`)
    .then(response => {
      const recomendaciones = response.data;
      mostrarRecomendaciones(recomendaciones);
      mostrarTotalProductosSimilares(recomendaciones.length);
    })
    .catch(error => {
      console.error('Error al cargar recomendaciones:', error);
    });
}

function mostrarRecomendaciones(recomendaciones) {
  const swiperWrapper = document.querySelector('#productos-recomendados .swiper-wrapper');
  swiperWrapper.innerHTML = ''; // Limpiar contenido previo

  recomendaciones.forEach(recomendacion => {
    const productoDiv = `
      <div class="swiper-slide">
        <div class="product-item product-item-carousel">
          <img src="${recomendacion.foto_url}" alt="${recomendacion.nombre}" class="product-image">
          <h3>${recomendacion.nombre}</h3>
          <p>${recomendacion.descripcion}</p>
          <p class="price">₲${Number(recomendacion.precio).toLocaleString('es-PY')}</p>
        </div>
      </div>
    `;
    swiperWrapper.innerHTML += productoDiv;
  });

  // Inicializar Swiper después de cargar los productos
  inicializarSwiper();
}

function inicializarSwiper() {
  new Swiper('.swiper-container', {
    slidesPerView: 3, // Número de productos visibles por página
    spaceBetween: 20, // Espacio entre los productos
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    autoplay: {
      delay: 3000, 
    },
    loop: true, 
  });
}

// Función para obtener y mostrar el total de productos sin stock
document.addEventListener('DOMContentLoaded', async () => {
    const sinStockElement = document.getElementById('productos-sin-stock');

    try {
        const response = await fetch('/api/productos/sin-stock');
        const data = await response.json();
        sinStockElement.textContent = data.total;
    } catch (error) {
        console.error('Error al cargar productos sin stock:', error);
        sinStockElement.textContent = 'Error al cargar';
    }
});

// Llamar a la función cuando la página cargue
document.addEventListener('DOMContentLoaded', obtenerTotalProductosSinStock);


    </script>
  </div>
</body>

</html>
